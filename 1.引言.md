# 第一章 引言

**计算机网络**：大量相互独立但彼此连接的计算机共同完成计算任务，这些系统被称为计算机网络。

**分布式系统**：分布式系统是建立在计算机网络上的软件系统，在用户看来，分布式系统是一个模型或范型。通常在操作系统之上有一层软件负责实现这个模型，这个软件就称为**中间件**。

最著名的分布式系统例子是**万维网**(World Wide Web)。万维网运行在`Internet`之上，这个模型的所有一切都表现得像是一个文档（`Web`页面）一样。


## 1.2 网路硬件

从广义上讲，目前普遍使用的**传输技术**有两种，分别是**广播式链路**和**点到点链路**。

**点对点链路**将一对单独的机器连接起来。在一个由点到点链路组成的网络中，为了从源端到达接收方，短消息必须首先访问一个或多个中间机器，这种短消息在某些情况下被称为数据包或包。

通常在网络中有可能存在多条不同长度的**路由**，因此，找到一条好的路由对点对点网络非常重要。

**点对点传输**只有一个发送方和一个接收方，有时候也称为**单播**。

在一个**广播**网络上，通信信道被网络上的所有机器共享：任何一台机器发出的数据包能被所有其他任何机器收到。

广播系统往往还提供将一个数据包发送给所有目标机器的可能性，只要在地址字段中使用一个特殊的编码。如果被传输的数据包带有这样的地址编码，那么网络中的每一台机器都将会接收该包并对其进行处理。这种模式被称为**广播**。

有些广播系统还支持给一组机器发送数据包的模式，这种传输模式称为**组播**。

另一个对网络进行分类的标准是网路钩长度，距离作为分类的指标：

### 1.2.1 个域网（PAN, Personal Area Network）

**个域网**允许设备围绕几个人进行通信。一个常见的例子是计算机通过无线网络与其外围设备连接（显示器、键盘、鼠标、打印机等）。

**个域网**通常用蓝牙、RFID等短场通信技术实现。

### 1.2.2 局域网（LAN, Local Area Network）

**局域网**是一种私有网络，一般在一座建筑物内或建筑物附近，比如家庭、办公室或工厂。

**局域网**被广泛用来连接个人计算机和消费电子设备，使他们能够共享资源和交换信息。

**接入点**（AP, Access Point）、**无线路由器**（wireless router）或者**基站**（base station）主要负责中继无线计算机之间的数据包，还负责中继无线计算机和Internet之间的数据包。

**无线局域网**的一个标准称为`IEEE 802.11`，俗称为`WIFI`，已经被非常广泛地使用。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001153033123.png" width = "80%">
<div align = left>

**有线局域网使**用了各种不同的传输技术，它们大多使用铜线或光线作为传输介质。

许多**有线局域网**的拓扑结构是以点到点链路为基础。俗称**以太网**（Ethernet）的`IEEE 802.3`是现如今最常用的一种有线局域网。

上图右边是一个**交换式以太网**的拓扑例子，其中每台计算机按照以太网协议规定的方式运行，通过一条点到点链路连接到一个盒子，这个盒子被称为**交换机**。

**虚拟局域网（VLAN）**是一组逻辑上的设备和用户，这些设备和用户并不受物理位置的限制，可以根据功能、部门及应用等因素将它们组织起来，相互之间的通信就好像它们在同一个网段中一样，由此得名虚拟局域网。

### 1.2.3 城域网（MAN, Metropolitan Area Network）

**城域网**的范围可以覆盖一个城市，最有名的城域网例子是许多城市都有的有线电视网。

下图是一个基于有线电视的城域网的结构图：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001154342864.png" width = "80%">
<div align = left>

从上图可以看到，电视信号和Internet流量都先被送到一个集中式线缆前端（cable headend），然后再分发到居民的家中。

**WiMAX**是一种城域网，它由最近发展的高速无线Internet催生而来，并且已经被标准化为`IEEE 802.16`。

### 1.2.4 广域网（WAN, Wide Area Network）

**广域网**的范围很大，它能跨越很大的地理区域，通常是一个国家、地区或者一个大陆。

下图是连接一个公司的三个办事处的广域网结构图：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001155118675.png" width = "80%">
  <div align = left>
    
其中，网络中的所有计算机被称为**主机（host）**，然后把连接这些主机的网络其余部分称为**通信子网**或者**子网**。

**子网**的工作是把信息从一个主机携带到另一个主机。

在大多数广域网中，子网由两个不同部分组成：**传输线路**和**交换元素**。

**传输线路**负责在及其之间移动比特，它们可以是铜线、光纤或者是无线链路。（大多数公司没有铺设自己的传输线路，因此，它们从电信公司租赁传输线路。）

**交换元素**或简称为**交换机**是专用的计算机，负责连接两条或两条以上的传输线路。当数据到达一条入境线路时，交换元素必须选择一条出境线路将数据转发出去。

这种负责交换的计算机在过去有各种不同的名称，现在最常用的名称是**路由器**。

**广域网**和**有线局域网**的区别通常由如下几点：
- 通常广域网中，主机和子网是由不同的人拥有和经营。
- 广域网中路由器通常连接不同类型的网络技术。例如，办公室内部网络可能是以太网，而长途传输线路可能是SONET链路.
- 广域网的子网可以连接单个计算机，就像局域网中一样，或者连接到整个局域网。

下面是两种不同类型的广域网：

**第一种广域网**，公司并不租赁专用的传输线路，而是把自己的办事处连接到Internet。这种方式下，办事处之间可以通过虚拟链路相互连接，而这些链路使用了底层Internet的容量。这种方式称为**虚拟专用网络**(VPN, Virtual Private Network)。

相比租赁专线，VPN具有虚拟化的一贯优势，它提供了重用某种资源（Internet连接）的灵活性。VPN也有虚拟化的一般缺点，即缺乏对底层资源的控制。采用专用线路能获得的容量是明确的，而使用VPN，所走的里程数可能会随Internet服务的变化而有所不同。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001164029933.png" width = "80%">
<div align = left>
    
**第二种广域网**，子网由不同的公司负责运营。子网运营者称为**网络服务提供商**（network service privider），公司办事处是它的客户。子网运营者还与Internet的其他网络相连。这样的子网运营商称为**Internet服务提供商**(ISP, Internet Service Provider)，相应的子网称为**ISP网络**。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001164503105.png" width = "80%">
<div align = left>
  
 ### 1.2.5 互联网络
 
一组相互连接的网络称为**互联网络**或**互联网**。

全球范围的**因特网**(Internet)通常用首字母大写来表示。Internet使用ISP网络来连接各种各样的企业网络、家庭网络和许多其他网络。

 ## 1.3 网络软件
 
 ### 1.3.1 协议层次结构
 
 为了降低网络设计的复杂性，绝大多数网络都组织成一个**层次栈**或**分级栈**，每一层都建立在其下一层的基础之上。
 
 一个机器上的第n层与另一台机器上的第n层进行对话，该对话中使用的规则和约定统称为第n层**协议**。
 
 不同机器上构成相应层次的实体称为**对等体**。这些对等体可能是软件过程、硬件设备，或者甚至是人类。
 
 在每一对相邻层次之间的是**接口**，接口定义了下层向上层提供哪些原语操作和服务。
 
 **层**和**协议**的集合称为**网络体系结构**。网络体系结构的规范必须包含足够的信息，以便实现着为每一层编写的程序或者设计的硬件能遵守有关的协议。
 
 一个特定的系统所使用的一组协议，即每一层一个协议，称为**协议栈**。
 
 ### 1.3.2 层次设计问题
 
 从接收到的信息中发现错误所用的一种机制是**检错编码**；然后重新传输接收到的不正确信息，直到它被正确接收为止。
 
 从最初收到的可能不正确的比特中恢复正确的消息的机制为**纠错**。
 
 这两种机制的工作都需要在被传的信息中添加冗余信息。这些冗余信息被较底层次用来保障数据包在个别链路上的正确传输，也可被较高层次用来检测接收到的数据包是否包含了正确的内容。
 
 **路由**：另一个可靠性问题是找到通过网络的工作路径。在源和目的地之间经常存在多条路径，而且在一个大型网络中可能由一些链路或路由偶尔发生故障。网络应该能够自动做出路由决策来找到一条可行的路径。
 
 由于网络上有许多计算机，每一层在特定的消息中都需要一种机制来标识发送方和接收方。这种机制在下层和高层分别称为**寻址**和**命名**。
 
 **统计复用**：许多网络设计根据主机的短期需求变化动态共享网络带宽，而不是给每个主机分配可能用也可能不会用的固定比例带宽。
 
 ### 1.3.3 面向连接与无连接服务
 
 **面向连接的服务**是按照电话系统建模的。这种连接最本质的方面在于它像一个管道：发送方把对象（数据位）压入管道的一端，接收方在管道的另一端将它们取出来。在绝大多数情况下，数据位保持原来的顺序，所以数据位都会按照发送的顺序到达。
 
 **面向无连接的服务**是按照邮政系统建模的。每个报文（信件）都携带了完整的目标地址，每个报文都由系统中的中间结点路由，而且路由独立于后续报文。
 
 如果中间结点只能在收到报文的全部内容之后再将该报文发送给下一个结点，那么称这种处理方式为**存储-转发交换**。有别于此的另一种处理方式是在报文还没有被全部接收完毕之间就向下一个节点传输，这种处理方式称为**直通式交换**。
 
 通常来说，当两个报文被发往同一个目的地时，首先被发送的报文将会先到达。然而，先发送的报文可能被延迟，因而后发送的报文比它先到达，这种情况也是有可能发生。
 
最适合用可靠的**面向连接服务**的一种典型情形是**文件传输**。文件的拥有者希望保证所有的数据位都能够正确地到达接收方，而且到达的顺序与发送的顺序相同。

可靠的面向连接服务有两个细微的**变异形式**：**报文序列**和**字节流**。

**报文序列**：报文的边界始终得到保持。发送两个1024字节的报文，收到的仍然是两个独立的长度为1024字节的报文，而绝不可能变成一个长度为2048字节的报文。

**字节流**：该连接只是一个字节流，没有任何报文边界。当2048个字节到达接收方时，接收方无法判断发送方发出的是一个长度为2048字节的报文，还是两个长度为1024字节的报文。

不可靠的无连接服务通常称为**数据报服务**，它与电报服务非常类似，一般不会给发送方反馈任何确认消息。尽管它是不可靠的，但在大多数网络中这是一种占主导地位的传输形式。

在其他情形下，的确需要这种无需建立连接就可发送一个报文的便利性，但是可靠性仍然是基本需求。**有确认的数据包服务**就是为这些应用提供的一类服务。

还有另一种服务是是**请求-应答服务**。这种服务中，发送方传输一个包含了某个请求的数据报；接收方以一个包含了请求结果的应答数据作为反馈。

### 1.3.4 服务原语

一个服务由一组**原语**正式说明，用户进程通过这些原语（操作）来访问该服务。

原语告诉服务要执行某个动作，或者将对等实体所执行的动作报告给用户。如果**协议栈**位于操作系统中（大多数情况是这样的），则这些服务原语通常是一些**系统调用**。这些系统调用会陷入**内核模式**，然后在内核模式中取代操作系统来控制机器发送必要的数据包。

面向连接服务的原语与无连接服务的原语是不同的。下面是一个简单地服务原语例子，可以实现一个可靠的字节流：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001180615665.png" width = "50%">
<div align = left>
下面是一个由确认数据报服务的简单协议实现的原理图：
<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191001182728770.png" width = "80%">
<div align = left>
 
 当然，实际情况下不会这么简单，很多地方都有可能出现错误情况，例如时间顺序可能出错（CONNECT在LISTEN之前完成）、数据包可能会丢失等。
 
 ### 1.3.5 服务与协议的关系
 
 **服务**是指某一层向它上一层提供的一组原语（操作）。服务定义了该层准备代表其用户执行哪些操作，但是它并不涉及如何实现操作。服务与两层之间的接口有关，低层是服务提供者，而上层是服务用户。
 
 **协议**是一组规则，规定了同一层上对等实体之间所交换的数据包或者报文的格式和含义。对等实体利用协议来实现它们的服务定义，它们可以自由地改变协议，只要不改变呈现给他们用户的服务即可。
 
 下图是服务与协议的关系：
 
 <div align = center>
  <img src = "https://img-blog.csdnimg.cn/20191001192844492.png" width = "60%">
  <div align = left>

## 1.4 参考模型

### 1.4.1 OSI参考模型

OSI模型如下图所示，该模型基于国际标准化组织（ISO, International Standards Organization）的提案，作为各层协议迈向国际标准化的第一步。

<div align = center>
  <img src = "https://img-blog.csdnimg.cn/2019100216415613.png" width = "80%">
  <div align = left>
 
上述模型称为ISO的**开放系统互连**（OSI, Open Systems Interconnection）参考模型。

值得注意的是，OSI参考模型本身并不是一个网络体系结构，因为它并没有定义每一层的服务和所用的协议。

**第一层 物理层**

**物理层**关注在一条通信信道上传输原始比特。设计问题必须确保当一方发送了比特1时，另一方收到的也是比特1。这里的典型问题包括用什么电子信号来表示1和0、一个比特持续多少纳秒、传输是否可以在两个方向上同时进行、初始连接如何建立、当双方结束之后如何撤销连接、网络连接器有多少针以及每一针的用途是什么。

**第二层 数据链路层**

**数据链路层**的主要任务是将一个原始的传输设施转变成一条没有漏检传输错误的线路。数据链路层完成这项任何的做法是将真实的错误掩盖起来，使得网络层看不到。为此，发送方将输入的数据拆分成**数据帧**，然后顺序发送这些数据帧。一个数据帧通常为几百个或者几千个字节长。如果服务是可靠的，则接收方必须确认正确收到的每一帧，即给发送方发回一个**确认帧**。

数据链路层（和大多数高层都存在）的另一个问题是如何避免一个快速发送方用数据“淹没”一个慢速接收方。因此，往往需要一种流量调节机制，以便让发送方直到接收方何时可以接收更多的数据。

广播式网络的数据链路层还有另一个问题：如何控制对共享信道的访问。数据链路层的一个特殊字层，即**介质访问控制子层**，就是专门处理这个问题的。

**第三层 网络层**

**网络层**的主要功能是控制子网的运行。一个关键的设计问题是如何将数据包从源端路由发送到接收方。**路由**可以建立在静态表的基础上，这些表相当于网络内部“布线”，而且很少会改变；或者，更常见的情况是路由可以自动更新，以此来避免网络中的故障组件。路由也可以在每次回话开始时就确定下来，比如登录到另一台远程机器上。最后，路由可以是高度动态的，针对每一个数据包都重新确定路径，以便反映网络当前的负载情况。

如果有太多的数据包同时出现在一个子网中，那么这些数据包彼此之间会相互阻碍，从而形成传输瓶颈。处理拥塞也是网络层的责任，一般要和高层协议结合起来综合处理拥塞才有效，高层协议必须适应它们注入网络中的负载。更普遍的是网络所提供的服务质量（延迟、传输时间、抖动等）也是网络层的问题。

当一个数据包必须从一个网络传输到另一个网络才能达到它的目的地时，可能会发生许多问题。比如，第二个网络所使用的寻址方案可能与第一个网络不同；第二个网络可能无法接受这个数据包，因为它太大了；两个网络所使用的协议也可能不一样，等等。网络层应该解决所有这些问题，从而允许异构网络相互连接成为互联网络。

在广播式网络中，路由问题比较简单，所有网络层往往比较单薄，甚至根本不存在。

**第四层 传输层**

**传输层**的基本功能是接收来自上一层的数据，在必要的时候把这些数据分割成较小的单元，然后把这些数据单元传递给网络层，并且保证这些数据单元正确地到达另一端。而且，所有这些工作都必须高效率同时以一种上下隔离的方式完成，即随着时间的推移导致底层硬件技术不可避免地发生改变时，对上面各层是透明的。

传输层还决定了向会话层，因而是实际的最终网络用户提供哪种类型的服务。其中最为常见的传输连接是一个完全无错的点到点信道，此信道按照原始发送的顺序来传输报文或者字节数据。然而，其他类型的传输服务也有可能，例如传输独立的报文但不保证传送的顺序、将报文广播给多个目标结点等。服务的类型是在建立连接时就确定下来的。

传输层是真正的端到端的层，它至始至终将数据从源端携带到接收方。换句话说，源机器上的一个程序利用报文头和控制信息与目标机器上的一个类型程序进行会话。在其下面的各层，每个协议涉及一台机器与它的直接邻居，而不涉及最终的源机器和目标机器，即源机器和目标机器可能被多个中间路由隔离了。

第1-3层是链式的，而第4-7层是端到端的，二者的区别如上图所示。

**第五层 会话层**

**会话层**允许不同机器上的用户建立会话。会话通常提供各种服务，包括**对话控制**、**令牌管理**，以及**同步功能**。

**第六层 表示层**

**表示层**以下的各层最关注的的是如何传递数据位，而**表示层**关注的是所传递信息的语法和语义。不同的计算机可能由不沟通的内部数据表示法，为了让这些计算机能够进行通信，它们所交换的数据结构必须以一种抽象的方式来定义，同时还应该定义一种“线上”使用的标准编码方式。表示层管理这些抽象的数据结构，并允许定义和交换更高层的数据结构。

**第七层 应用层**

**应用层**包含了用户需要的各种各样的协议。一个得到广泛使用的应用协议是**超文本传输协议**（HTTP），它是**万维网**的基础。当浏览器需要一个Web页面时，它通过HTTP将所要的页面的名字发送给服务器，然后服务器将页面发回给浏览器。其他的一些应用协议可用于文件传输、电子邮件以及网络新闻等。

### 1.4.2 TCP/IP参考模型

**TCP/IP参考模型**是另一个参考模型，它不仅被所有广域计算机网络的鼻祖`ARPANET`所采用，而且被其继任者--全球范围的`Internet`所使用。

`ARPANET`是由美国国防部资助的一个研究性网络。它通过租用的电话线，将几百所大学和政府部门的计算机设备连接起来。后来当卫星和无线网络也要加入时，发现原来的协议在与它们互联时遇到了很大的麻烦，因而需要一种新的参考体系模型。

所以，以无缝的方式将多个网络连接起来是从一开始就指定的主要目标之一。这个体系结构后来称为**TCP/IP参考模型**

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191002211221930.png" width = "80%">
<div align = left>
